<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>모임 상세 - 유료</title>
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
    <link rel="stylesheet" th:href="@{/css/meeting-detail.css}">
    <link rel="stylesheet"
          href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css"
          integrity="sha512-xh6O/CkQoPOWDdYTDqeRdPCVd1SpvCA9XXcUnZS2FmJNp1coAFzvtCN9BmamE+4aHK8yyUHUSCcJHgXloTyT2A=="
          crossorigin="anonymous" referrerpolicy="no-referrer" />
</head>
<body>
<div th:include="navbarJ"></div>
<br/>
<div class="container">
    <div class="row">
        <div class="col-md-6">
            <img th:src="${meetingDto.path}"/>
        </div>
        <div class="col-md-6">
            <h3 th:text="${meetingDto.meetingTitle}"></h3>
            <p th:text="${meetingDto.meetingDescription}"></p>
            <br/>
            <div class="info">
                <h5>카테고리</h5>
                <label th:text="${meetingDto.meetingCategory.getValue()}"> </label>
            </div>
            <br/>
            <div class="info">
                <h5>온라인/오프라인</h5>
                <label th:text="${meetingDto.meetingType.getValue()}"> </label>
            </div>
            <br/><br/>
            <div class="info">
                <h5>신청 하기</h5>
                <input type="text" class="text-center" th:value="${meetingDto.getPrice()}" readonly>
                <button class="btn btn-primary" id="payment-button"
                        th:data-url="@{'/meetings/' + ${meetingDto.getId()} + '/applications'}">
                    결제 하기
                </button>
                <script>
                    document.getElementById('payment-button').addEventListener('click', function () {
                        window.location.href = this.getAttribute('data-url');
                    });
                </script>

            </div>
            <div class="d-flex justify-content-end">
                <span th:if="${sym != null and !sym}" id="meetingSym" class="fa-stack fa-2x">
                    <i id="heart1" class="fas fa-heart fa-stack-1x" style="color: white"></i>
                    <i id="heart2" class="far fa-heart fa-stack-1x" style="color: #84799F"></i>
                </span>
                <span th:if="${sym != null and sym}" id="meetingSym" class="fa-stack fa-2x">
                    <i id="heart1" class="fas fa-heart fa-stack-1x" style="color: red"></i>
                    <i id="heart2" class="far fa-heart fa-stack-1x" style="color: red"></i>
                </span>
            </div>
        </div>
    </div>
    <br/>
    <hr>
    <br/><br/>
    <div class="info">
        <h5>호스트 닉네임</h5>
        <label th:text="${meetingDto.nickName}"> </label>
    </div>
    <br/>
    <div class="info">
        <h5>모집 기간</h5>
        <label th:text="${#temporals.format(meetingDto.recruitmentStartDateTime, 'yy-MM-dd HH:mm:ss')} + ' ~ ' + ${#temporals.format(meetingDto.recruitmentEndDateTime, 'yy-MM-dd HH:mm:ss')}"> </label>
    </div>
    <br/>
    <div class="info">
        <h5>모임 시작 시간</h5>
        <label th:text="${#temporals.format(meetingDto.meetingStartDateTime, 'yy-MM-dd HH:mm:ss')}"> </label>
    </div>
    <br/>
    <div class="info">
        <h5>장소</h5>
        <label th:text="'주소 : ' + ${meetingDto.meetingAddress.getAddress()}"> </label> <br/>
        <label th:text="'상세 주소 : ' + ${meetingDto.meetingAddress.getDetailAddress()}"> </label> <br/>
        <label th:text="'위치 설명 : ' + ${meetingDto.meetingAddress.getLocationDescription()}"> </label> <br/>
    </div>
    <br/>
    <div class="info">
        <h5>인원 제한</h5>
        <label th:text="${meetingDto.participantRange.getMaxParticipants()}"> </label>
    </div>
    <br/>
    <div class="info">
        <h5>참가 비용</h5>
        <label th:text="${meetingDto.getPrice()} + '원'"> </label>
    </div>
    <br/>
    <div class="info">
        <h5>반려견 동반 유무</h5>
        <label th:text="${meetingDto.petAllowedStatus.value}"> </label>
    </div>
    <br/>
    <div class="info">
        <h5>연락수단</h5>
        <div th:if="${meetingDto.meetingContact.phone} != null">
            <label>전화번호: </label>
            <label th:text="${meetingDto.meetingContact.phone}"> </label>
        </div>
        <div th:if="${meetingDto.meetingContact.email} != null">
            <label>이메일: </label>
            <label th:text="${meetingDto.meetingContact.email}"> </label>
        </div>
        <div th:if="${meetingDto.meetingContact.kakaoId} != null">
            <label>카카오톡 아이디: </label>
            <label th:text="${meetingDto.meetingContact.kakaoId}"> </label>
        </div>
        <div th:if="${meetingDto.meetingContact.link} != null">
            <label>링크: </label>
            <label th:text="${meetingDto.meetingContact.link}"> </label>
        </div>
        <div th:if="${meetingDto.meetingContact.otherLink} != null">
            <label>기타 링크: </label>
            <label th:text="${meetingDto.meetingContact.otherLink}"> </label>
        </div>
    </div>
    <br/>
    <div>
        <!-- 모임 소개 더보기 -->
        <br/><br/>
        <div class="container text-center">
            <p id="more-text" style="display: none;" th:text="${meetingDto.meetingFreeFormDetails}"></p>
            <button class="btn btn-light" id="more-btn">모임 소개 더보기</button>
        </div>
    </div>
    <br/>
    <hr>
    <br/>
    <!-- 취소 및 환불 규정 -->
    <div class="container text-center">
        <h5>취소 및 환불 규정</h5>
        <!-- 여기 아래에 테두리 빼기. -->
        <p class="list-group-item">- 행사의 취소/환불 기간은 행사 호스트가 설정한 신청기간과 동일합니다. <br/>
            - 신청한 행사의 신청 정보 수정 및 취소/환불은 ‘마이페이지-신청 행사’에서 할 수 있습니다. <br/>
            - 결제 수단, 환불 신청 시점, 환불 사유에 따라 환불 수수료가 부과될 수 있습니다. <br/>
            - 위에 대한 자세한 내용은 ‘취소 및 환불규정’에서 확인할 수 있습니다. <br/>
            - 신청기간 마감 이후의 신청 정보 수정 및 취소/환불은 행사 호스트에게 문의 부탁드립니다. <br/>
            - 행사에 관련된 사항은 하단의‘문의하기’를 통해 행사 호스트에게 문의 부탁 드립니다. <br/>
        </p>
        <p class="text-danger mt-3">* 모이개는 통신판매 중개자이며, 해당 행사의 호스트가 아닙니다.</p>
    </div>
    <br/>
    <hr>
    <br/>
    <!-- 댓글 -->
    <br/><br/><br/><br/><br/>
    <div>
        <br/><br/><br/>
        <h1>댓글 아직 안담</h1>
        <br/><br/><br/>
    </div>
</div>
<script th:inline="javascript">
    var userId = /*[[${customUser != null ? customUser.id : null}]]*/ null;
    var meetingId = /*[[${meetingDto != null ? meetingDto.id : null}]]*/ null;
</script>
<script>
    document.getElementById('more-btn').addEventListener('click', function () {
        var moreText = document.getElementById('more-text');
        if (moreText.style.display === "none") {
            moreText.style.display = "block";
            this.innerText = "숨기기";
        } else {
            moreText.style.display = "none";
            this.innerText = "행사 소개 더보기";
        }
    });

    $("#meetingSym").click(function() {
        $.ajax({
            url: '/meetings/symUp',
            type: 'POST',
            contentType: 'application/json', // JSON 형식으로 전송
            data: JSON.stringify({ userId: userId, meetingId: meetingId }),
            success: function(response) {
                if (response.statusSym === true) {
                    $("#heart1").css("color", "red");
                    $("#heart2").css("color", "red");
                } else {
                    $("#heart1").css("color", "white");
                    $("#heart2").css("color", "#84799F");
                }
            },
            error: function(error) {
                console.log(error);
            }
        });
    });
</script>
</body>
</html>